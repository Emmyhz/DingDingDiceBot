# DiceUtilities class

一个静态工具类，提供利用钉钉企业私有机器人进行投骰的业务支持。

```csharp
public static class DiceUtilities
```

## Public Members

| name | description |
| --- | --- |
| static [GetResponeFromRequest](DiceUtilities/GetResponeFromRequest.md)(…) | 解析 [`RequestJson`](RequestJson.md) 中的用户消息，并以 [`ResponeJson`](ResponeJson.md) 的形式返回处理结果。 |
| static [GetResultFromCommand](DiceUtilities/GetResultFromCommand.md)(…) | 对指定的字符串进行指令解析，并返回一个表示处理后结果的字符串。 |
| static [VerifyAuthorizedAccess](DiceUtilities/VerifyAuthorizedAccess.md)(…) | 根据 *timestamp*、*sign* 以及目标 *appSecret* 验证请求是否有权使用本服务。 |
| static [VerifyRequestHeaders](DiceUtilities/VerifyRequestHeaders.md)(…) | 根据 `HTTP POST` 请求的 `HTTP HEADER` 验证网络请求是具有授权。 |

## Remarks

关于钉钉私有机器人的工作方式和部署方法详见钉钉开发文档：

https://ding-doc.dingtalk.com/doc?spm=a2115p.8777639.0.0.205a4260i2g1Q8#/serverapi2/elzz1p

此静态类的所有成员都是线程安全的。

## Examples

这里展示了如何利用此工具类处理来自钉钉的用户聊天记录。

```csharp
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

using System.Net.Mime;
using System.Threading.Tasks;

namespace Sample
{
    [ApiController]
    [Route("[controller]")]
    public class Roll : ControllerBase
    {
        [HttpPost]
        [Consumes(MediaTypeNames.Application.Json)]
        [ProducesResponseType(StatusCodes.Status200OK)]
        [ProducesResponseType(StatusCodes.Status401Unauthorized)]
        public async Task<ActionResult<DingDingDiceBot.ResponeJson>> PostAsync(DingDingDiceBot.RequestJson body)
        {
            // 验证请求是否来自钉钉。
            // DingDingDiceBot.DiceUtilities.VerifyRequestHeaders(IHeaderDictionary, string) 方法提供了验证的实现。
            if (!DingDingDiceBot.DiceUtilities.VerifyRequestHeaders(HttpContext.Request.Headers, APP_SECRET))
            {
                return Unauthorized();
            }
            // 直接读取请求的 BODY ，并返回计算结果。
            return await Task.FromResult(DingDingDiceBot.DiceUtilities.GetResponeFromRequest(body));
        }
        // 由钉钉开放平台分配密钥。
        private const string APP_SECRET = "XXXXXXXXXXXX";
    }
}
```

## See Also

* namespace [DingDingDiceBot](../DingDingDiceBot.md)

<!-- DO NOT EDIT: generated by xmldocmd for DingDingDiceBot.dll -->
